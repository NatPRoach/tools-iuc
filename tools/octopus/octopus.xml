<?xml version="1.0"?>
<tool id="octopus" name="Octopus Variant Calling" version="@TOOL_VERSION@+galaxy0" profile="@PROFILE@">
    <description>Mapping based variant calling</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements">
    </expand>

    <expand macro="version_command"/>

    <command detect_errors="exit_code"><![CDATA[
@REF_FASTA@

octopus
    '${log_level}'
    '${speed}'
    --output '${variants_out}'
    --threads \${GALAXY_SLOTS:-4}
    --reference reference.fa
    --reads
#for $read in $reads:
    '${read}'
#end for
    '${one_based_indexing}'
    --regions
#for $region in $regions:
    '${region.region}'
#end for
    --regions-file '${regions_file}'
    --skip-regions
#for $region in $skip_regions:
    '${region.skip_region}'
#end for
    --skip-regions-file '${skip_regions_file}'
    --samples
#for $sample in $samples:
    '${sample.sample}'
#end for
    --samples-file '${samples_file}'
    '${ignore_unmapped_contigs}'
    --pedigree '${pedigree}'
## Little unclear on this. Is it a text param or something else. Come back to it
##    --contig-output-order
    '${sites_only}'
    '${legacy}'
    --regenotype '${regenotype}'
    --bamout '${bam_out}'
    --split-bam-out '${split_bamout}'
    --data-profile '${profile_out}'

&& cat octopus_debug.log 1>&2
    ]]></command>
    <inputs>
        <section title="General" expanded="false">
            <param name="log_level" type="select" label="" help="">
                <option value="--debug" selected="true">Write verbose debug info to stderr</option>
                <option value="--trace">Write very verbose debug info to stderr</option>
            </param>
            <param name="speed" type="select" label="" help="Fast is equivalent to '-a off -l minimal -x 50'">
                <option value="" selected="true">Default accuracy to speed parameters</option>
                <option value="--fast">Fast - Turn off some features to improve runtime, at the cost of decreased calling accuracy.</option>
                <option value="--very-fast">Very fast - The same as fast but also disables inactive flank scoring.</option>
            </param>
        </section>
        <section name="io" title="Inputs and Outputs" expanded="true">
            <param argument="--reference" />
            <param argument="--reads" />
            <param argument="--one-based-indexing" />
            <param argument="--regions" />
            <param argument="--regions-file" />
            <param argument="--skip-regions" />
            <param argument="--skip-regions-file" />
            <param argument="--samples" />
            <param argument="--samples-file" />
            <param argument="--ignore-unmapped-contigs" />
            <param argument="--pedigree" />
            <param argument="--contig-output-order" />
            <param argument="--sites-only" />
            <param argument="--regenotype" />
            <param argument="--legacy" />
            <param argument="--bamout" />
            <param argument="--full-bamout"/>
            <param argument="--data-profile"/>
        </section>
        <section name="transform" title="Read transformations" expanded="false">
            <param argument="--read-transforms"/>
            <param argument="--mask-low-quality-tails"/>
            <param argument="--mask-tails"/>
            <param argument="--soft-clip-masking"/>
            <param argument="--soft-clip-mask-threshold"/>
            <param argument="--mask-soft-clipped-boundary-bases"/>
            <param argument="--adapter-masking"/>
            <param argument="--overlap-masking"/>
            <param argument="--mask-inverted-soft-clipping"/>
            <param argument="--mask-3prime-shifted-soft-clipped-heads"/>
        </section>
        <section name="" title="Read filtering" expanded="false">
            <param argument="--read-filtering" />
            <param argument="--consider-unmapped-reads" />
            <param argument="--min-mapping-quality" />
            <param argument="--good-base-quality" />
            <param argument="--min-good-base-fraction" />
            <param argument="--min-good-bases" />
            <param argument="--allow-qc-fails" />
            <param argument="--min-read-length" />
            <param argument="--max-read-legnth" />
            <param argument="--allow-marked-duplicates" />
            <param argument="--allow-octopus-duplicates" />
            <param argument="--allow-secondary-alignments" />
            <param argument="--allow-supplementary-alignments"/>
            <param argument="--no-reads-with-unmapped-segments"/>
            <param argument="--no-reads-with-distant-segments"/>
            <param argument="--no-adapter-contaminated-reads"/>
            <param argument="--disable-downsampling"/>
            <param argument="--downsample-above"/>
            <param argument="--downsample-target"/>
        </section>
        <section title="Candidate variant generation" expanded="false">
            <param argument="--raw-cigar-candidate-generator"/>
            <param argument="--repeat-candidate-generator"/>
            <param argument="--assembly-candidate-generator"/>
            <param argument="--source-candidates"/>
            <param argument="--source-candidates-file"/>
            <param argument="--min-source-quality"/>
            <param argument="--use-filtered-source-candidates"/>
            <param argument="--min-base-quality"/>
            <param argument="--min-supporting-reads"/>
            <param argument="--max-variant-size"/>
            <param argument="--kmer-sizes"/>
            <param argument="--num-fallback-kmers"/>
            <param argument="--fallback-kmer-gap"/>
            <param argument="--max-region-to-assemble"/>
            <param argument="--max-assemble-region-overlap"/>
            <param argument="--assemble-all"/>
            <param argument="--assembler-mask-base-quality"/>
            <param argument="--min-kmer-prune"/>
            <param argument="--max-bubbles"/>
            <param argument="--min-bubble-score"/>
        </section>
        <section title="Haplotype generation" expanded="false">
            <param argument="--max-haplotypes"/>
            <param argument="--haplotype-holdout-threshold"/>
            <param argument="--haplotype-overflow"/>
            <param argument="--max-holdout-depth"/>
            <param argument="--extension-level"/>
            <param argument="--haplotype-extension-threshold"/>
            <param argument="--dedup-haplotypes-with-prior-model"/>
            <param argument="--protect-reference-haplotype"/>
        </section>
        <section title="Calling" expanded="true">
            <param argument="--caller"/>
            <param argument="--organism-ploidy"/>
            <param argument="--contig-ploidies"/> <!-- TODO - make repeat? -->
            <param argument="--contig-ploidies-file"/>
            <param argument="--min-variant-posterior"/>
            <param argument="--refcall"/>
            <param argument="--min-refcall-posterior"/>
            <param argument="--snp-heterozygosity"/>
            <param argument="--snp-heterozygosity-stdev"/>
            <param argument="--indel-heterozygosity"/>
            <param argument="--use-uniform-genotype-priors"/>
            <param argument="--max-genotypes"/>
            <param argument="--max-joint-genotypes"/>
            <param argument="--use-independent-genotype-priors"/>
            <param argument="--model-posterior"/>
            <param argument="--inactive-flank-scoring"/>
            <param argument="--model-mapping-quality"/>
            <param argument="--sequence-error-model"/>
            <param argument="--max-vb-seeds"/>
        </section>
        <section title="Phasing">
            <param argument="--phasing-level"/>
            <param argument="--min-phase-score"/>
        </section>
        <section title="Variant filtering">
            <param argument="--call-filtering"/>
            <param argument="--filter-expression"/>
            <param argument="--somatic-filter-expression"/>
            <param argument="--denovo-filter-expression"/>
            <param argument="--refcall-filter-expression"/>
            <param argument="--use-calling-reads-for-filtering"/>
            <param argument="--keep-unfiltered-calls"/>
            <param argument="--training-annotations"/>
            <param argument="--filter-vcf"/> <!-- TODO - make this a separate tool?-->
            <param argument="--forest-file" optional="true"/>
            <param argument="--somatic-forest-file" optional="true"/>
        </section>
    </inputs>
    <outputs>
    </outputs>
    <tests>
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

@WID@

**Input**

- reference sequence (FASTA)

**Output**

- (VCF)

**References**

@REFERENCES@
    ]]></help>
    <expand macro="citations"/>
</tool>
